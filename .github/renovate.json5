// SPDX-FileCopyrightText: 2017-2025 City of Espoo
//
// SPDX-License-Identifier: LGPL-2.1-or-later
{
  $schema: 'https://docs.renovatebot.com/renovate-schema.json',
  timezone: 'Europe/Helsinki',
  extends: [
    'config:recommended',
  ],
  semanticCommits: 'disabled',
  automergeStrategy: 'merge-commit',

  // Wait for a version to be 5 days old before making a PR
  minimumReleaseAge: '5 days',

  // Update during weekends
  schedule: ['* * * * 0,6'],

  // Allow most 20 PRs open concurrently
  prConcurrentLimit: 20,

  // No rate limit for PR creation
  prHourlyLimit: 0,

  // Pin all dependencies to exact versions
  rangeStrategy: 'pin',

  // Deduplicate npm packages
  postUpdateOptions: ['yarnDedupeHighest', 'npmDedupe'],

  labels: ['dependencies'],
  packageRules: [
    {
      matchFileNames: ['apigw/**'],
      addLabels: ['apigw'],
    },
    {
      matchFileNames: ['frontend/**'],
      addLabels: ['frontend'],
    },
    {
      matchFileNames: ['service/**'],
      addLabels: ['service'],
    },
    {
      // Automerge patch versions of all dependencies
      matchUpdateTypes: ['patch'],
      automerge: true,
    },
    {
      // Automerge minor and patch versions for devDependencies
      matchDepTypes: ['devDependencies'],
      matchUpdateTypes: ['minor', 'patch'],
      automerge: true,
    },
    {
      // Don't pin engines in package.json
      matchDepTypes: ['engines'],
      rangeStrategy: 'auto'
    },
    {
      // Don't update Font Awesome icons past 6.x
      matchPackageNames: [
        '@fortawesome/fontawesome-svg-core',
        '@fortawesome/free-regular-svg-icons',
        '@fortawesome/free-solid-svg-icons'
      ],
      allowedVersions: '< 7.0.0'
    },
    {
      // Paid Font Awesome packages are not avilable in public npm
      matchPackageNames: [
        '@fortawesome/pro-light-svg-icons',
        '@fortawesome/pro-regular-svg-icons',
        '@fortawesome/pro-solid-svg-icons',
      ],
      enabled: false,
    },
  ],
}
