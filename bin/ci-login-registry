#!/bin/bash

# SPDX-FileCopyrightText: 2017-2021 City of Espoo
#
# SPDX-License-Identifier: LGPL-2.1-or-later

set -eu

cd "$( dirname "${BASH_SOURCE[0]}")"

LOGIN_TYPE="${LOGIN_TYPE:-}"

if [ "$LOGIN_TYPE" = "aws-config" ]; then
    ./ci-login-cloud

    echo "Login to ECR"

    ECR_HOST="${ECR_HOST:-https://307238562370.dkr.ecr.eu-west-1.amazonaws.com}"

    aws ecr get-login-password \
        --region "${AWS_REGION:-eu-west-1}" \
        --profile "${AWS_PROFILE:-voltti-sst}" \
        | docker login \
            --username AWS \
            --password-stdin \
            "$ECR_HOST"
else
    echo "Missing or invalid LOGIN_TYPE parameter"
    exit 1
fi
